{% extends 'base/layout.html' %}
{% load static %}
{% block body %}
<!DOCTYPE html>
<html>
  <head>
    <title>Map</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBSVrko0G0Tjj-Y9UCEWKGTC0oI8kK3m8Q"></script>
    <style>

      #main-container {
        display: flex;
        height: 100vh;
        justify-content: start;
        align-items: flex-start;
      }
      
      p {
        word-wrap: break-word;
        overflow-wrap: break-word;
      }

      #map-container {
        flex-direction: row;
        display: flex;
        justify-content: right;
        align-items: start;
      }
      #map {
        width: 300px;
        height: 300px;
        border-radius: 50%;
        overflow: hidden;
      }
      #challenges-container {
        flex: 1;
        display: flex;
        flex-direction: column;
        justify-content: start;
        align-items: center;
      }
      body {
        background-color: #faf6e7;
      }
      .card-body {
        {% comment %} background-color: #faf6e7; {% endcomment %}
        
      }

      .about-card {
        max-width: 50%;
      }
      .card {
        position: relative;
        display: flex;
        flex-direction: column;
        min-width: 0;
        word-wrap: break-word;
        background-color: #fff;
        background-clip: border-box;
        border: 1px solid #f2f4f9;
        border-radius: 0.25rem;
        backgroud-color: #faf6e7;
      }
      
      .card-wrapper {
        display: flex;
        flex-direction: row;
      }
      .card-equal {
        backgroud-color: transparent;
        flex: 1;
      }
      
    </style>
  </head>
  <body>
<!-- Main Container -->
<div id="main-container">
  <!-- Outer Map Card Container -->
  <div class="card" style="flex-direction: row;">
    <div class="card-body">
      <!-- Map Container -->
      <div id="map-container">
        <div class="about-card">
          <div class="card-body">
            <div class="d-flex align-items-center justify-content-between mb-2">
              <h6 class="card-title mb-0">About</h6>
              <div class="dropdown">
              </div>
            </div>
            <p>{{ user.sustainer.about }}</p>
            <div class="mt-3">
              <label class="tx-11 font-weight-bold mb-0 text-uppercase">Joined:</label>
              <p class="text-muted">{{ user.sustainer.joined }}</p>
            </div>
            <div class="mt-3">
              <label class="tx-11 font-weight-bold mb-0 text-uppercase">Lives:</label>
              <p class="text-muted">{{ user.sustainer.city}}, {{ user.sustainer.state }}</p>
            </div>
            <div class="mt-3">
              <label class="tx-11 font-weight-bold mb-0 text-uppercase">Email:</label>
              <p class="text-muted">{{ user.email }}</p>
            </div>
            <div class="mt-3">
              <label class="tx-11 font-weight-bold mb-0 text-uppercase">LinkedIn:</label>
              <p class="text-muted">{{ user.sustainer.linked_in }}</p>
            </div>
            <div class="mt-3 d-flex social-links">
              <a href="javascript:;" class="btn d-flex align-items-center justify-content-center border mr-2 btn-icon github">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-github" data-toggle="tooltip" title data-original-title="github.com/nobleui">
                  <path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22"></path>
                </svg>
              </a>
              <a href="javascript:;" class="btn d-flex align-items-center justify-content-center border mr-2 btn-icon twitter">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-twitter" data-toggle="tooltip" title data-original-title="twitter.com/nobleui">
                  <path d="M23 3a10.9 10.9 0 0 1-3.14 1.53 4.48 4.48 0 0 0-7.86 3v1A10.66 10.66 0 0 1 3 4s-4 9 5 13a11.64 11.64 0 0 1-7 2c9 5 20 0 20-11.5a4.5 4.5 0 0 0-.08-.83A7.72 7.72 0 0 0 23 3z"></path>
                </svg>
              </a>
              <a href="javascript:;" class="btn d-flex align-items-center justify-content-center border mr-2 btn-icon instagram">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-instagram" data-toggle="tooltip" title data-original-title="instagram.com/nobleui">
                  <rect x="2" y="2" width="20" height="20" rx="5" ry="5"></rect>
                  <path d="M16 11.37A4 4 0 1 1 12.63 8 4 4 0 0 1 16 11.37z"></path>
                  <line x1="17.5" y1="6.5" x2="17.51" y2="6.5"></line>
                </svg>
              </a>
            </div>
          </div>
        </div>
        <button type="button" class="btn btn-primary ms-auto" data-bs-toggle="modal" data-bs-target="#editProfileModal">
          Edit Profile
        </button>
        <div class="card" style="background-color: white;">
          <p class="font-monospace text-center">{{ user.first_name }}'s challenges</p>
          <div class="card-body">
            <div id="map"></div>
          </div>
        </div>
      </div>
      <!-- Inner Challenges Card Container -->
      <div class="card">
        <div class="card-body">
          <div id="challenges-container">
            {% for challenge in challenges %}
              <div class="card mb-3">
                <div class="card-body">
                  <p class="font-monospace text-center">Lat: {{ challenge.latitude }}, Lng: {{ challenge.longitude }}</p>
                  <p class="font-monospace text-center">Cause: {{ challenge.cause }}</p>
                  <p class="font-monospace text-center">Description: {{ challenge.description }}</p>
                </div>
              </div>
            {% empty %}
              <p class="font-monospace text-center">No challenges found.</p>
            {% endfor %}
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

    <script>
      function initMap(customMapStyles, selectedStyle) {
        var map = new google.maps.Map(document.getElementById('map'), {
            center: {lat: 0, lng: 0},
            zoom: 0,
            disableDefaultUI: true,  // This removes most controls
            zoomControl: false,  // This removes the zoom buttons
            mapTypeControl: false,  // This removes the map/satellite toggle
            streetViewControl: false, // This removes the Street View button
            styles: customMapStyles[selectedStyle]
            
        });

        var challenges = [
            {% for challenge in challenges %}
            {lat: {{ challenge.latitude }}, lng: {{ challenge.longitude }}, desc: "{{ challenge.description }}"},
            {% endfor %}
        ];
          // Create a LatLngBounds object
          var bounds = new google.maps.LatLngBounds();

          challenges.forEach(function(challenge) {
            console.log(challenge);
              var marker = new google.maps.Marker({
                  position: new google.maps.LatLng(challenge.lat, challenge.lng),
                  map: map
              });

              // Extend the bounds to include this marker's position
              bounds.extend(marker.getPosition());

              var infoWindow = new google.maps.InfoWindow({
                  content: challenge.desc
              });

              marker.addListener('click', function() {
                  infoWindow.open(map, marker);
              });
          });

          // Fit the map to the bounds of the markers
          map.fitBounds(bounds);
          google.maps.event.addListener(map, 'zoom_changed', function () {
            var zoom = map.getZoom();
            if (zoom > 18) { // set whatever maximum zoom level you want here
                map.setZoom(18);
            }
            if (zoom < 1) {
                map.setZoom(4);
            }
        });
      }

      fetch("{% static 'sustain_app/map_style.json' %}")
      .then(response => response.json())
      .then(data => {
          var selectedStyle = 'style1';  // Choose the style you want
          initMap(data, selectedStyle);
      })
      .catch(error => console.log('Error fetching map style:', error));
      google.maps.event.addDomListener(window, 'load', initMap);
    </script>
    <!-- Edit Profile Modal -->
<div class="modal fade" id="editProfileModal" tabindex="-1" aria-labelledby="editProfileModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="editProfileModalLabel">Edit Profile</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <form method="post" action="{% url 'profiles:profile' %}" enctype="multipart/form-data">
          {% csrf_token %}
          <div class="mb-3">
            <label for="about" class="form-label">About</label>
            <textarea class="form-control" id="about" name="about" rows="5">{{ user.sustainer.about }}</textarea>
          </div>
          <div class="mb-3">
            <label for="city" class="form-label">City</label>
            <input type="city" class="form-control" id="city" name="city" value="{{ user.sustainer.city }}">
          </div>
          <div class="mb-3">
            {{ form.state.label_tag }}
            {{ form.state }}
            {{ form.state.errors }}
          </div>
          
          <div class="mb-3">
            <label for="linked_in" class="form-label">LinkedIn</label>
            <input type="linked_in" class="form-control" id="linked_in" name="linked_in" value="{{ user.sustainer.linked_in }}">
          </div>
          <div class="mb-3">
            <label for="profile_picture" class="form-label">Profile Picture</label>
            <input type="file" class="form-control" id="profile_picture" name="profile_picture">
        </div>
    
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
        <button type="submit" class="btn btn-primary">Save changes</button>
      </div>
    </div>
  </div>
</div>
  </body>
</html>
{% endblock  %}
