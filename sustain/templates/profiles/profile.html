{% load static %}
<!DOCTYPE html>
<html>
  <head>
    <title>Map</title>
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBSVrko0G0Tjj-Y9UCEWKGTC0oI8kK3m8Q"></script>
    <style>
      #map-container {
        display: flex;
        justify-content: center;
        align-items: center;
        height: 100vh;
      }
      #map {
        width: 600px;
        height: 600px;
        border-radius: 50%;
        overflow: hidden;
      }
      #location-directory {
        margin-top: 20px;
        font-size: 16px;
      }
      #location-directory li {
        margin-bottom: 5px;
      }
    </style>
  </head>
  <body>
    <div id="map-container">
      <div id="map"></div>
    </div>
    <div id="location-directory">
        <ul>
          {% for challenge in sustainer_challenges %}
          <li>{{ challenge.name }}</li>
          {% endfor %}
        </ul>
      </div>
    <script>
      function initMap(customMapStyles, selectedStyle) {
        var map = new google.maps.Map(document.getElementById('map'), {
            center: {lat: 0, lng: 0},
            zoom: 0,
            disableDefaultUI: true,  // This removes most controls
            zoomControl: false,  // This removes the zoom buttons
            mapTypeControl: false,  // This removes the map/satellite toggle
            streetViewControl: false, // This removes the Street View button
            styles: customMapStyles[selectedStyle]
            
        });

        var challenges = [
            {% for challenge in sustainer_challenges %}
            {lat: {{ challenge.latitude }}, lng: {{ challenge.longitude }}, name: "{{ challenge.description }}"},
            {% endfor %}
        ];
          // Create a LatLngBounds object
          var bounds = new google.maps.LatLngBounds();

          challenges.forEach(function(challenge) {
              var marker = new google.maps.Marker({
                  position: challenge,
                  map: map
              });

              // Extend the bounds to include this marker's position
              bounds.extend(marker.getPosition());

              var infoWindow = new google.maps.InfoWindow({
                  content: challenge.name
              });

              marker.addListener('click', function() {
                  infoWindow.open(map, marker);
              });
          });

          // Fit the map to the bounds of the markers
          map.fitBounds(bounds);
          google.maps.event.addListener(map, 'zoom_changed', function () {
            var zoom = map.getZoom();
            if (zoom > 18) { // set whatever maximum zoom level you want here
                map.setZoom(18);
            }
            if (zoom < 1) {
                map.setZoom(4);
            }
        });
      }

      fetch("{% static 'sustain_app/map_style.json' %}")
      .then(response => response.json())
      .then(data => {
          var selectedStyle = 'style1';  // Choose the style you want
          initMap(data, selectedStyle);
      })
      .catch(error => console.log('Error fetching map style:', error));
      google.maps.event.addDomListener(window, 'load', initMap);
    </script>
  </body>
</html>
